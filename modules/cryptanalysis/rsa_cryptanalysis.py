from modules.base_module import CryptoModule
import streamlit as st
import pandas as pd
import numpy as np
import secrets
import time
import math
from typing import List, Tuple, Dict
import matplotlib.pyplot as plt
import sympy
from sympy import factorint, gcd, mod_inverse
import random

class RSACryptanalysisModule(CryptoModule):
    def __init__(self):
        super().__init__()
        self.name = "–ö—Ä–∏–ø—Ç–æ–∞–Ω–∞–ª–∏–∑ RSA"
        self.description = "–ú–µ—Ç–æ–¥—ã –∞–Ω–∞–ª–∏–∑–∞ –∏ –∞—Ç–∞–∫ –Ω–∞ RSA –∫—Ä–∏–ø—Ç–æ—Å–∏—Å—Ç–µ–º—É"
        self.complexity = "expert"
        self.category = "cryptanalysis"
        self.icon = ""
        self.order = 5
    
    def render(self):
        st.title("üîì –ö—Ä–∏–ø—Ç–æ–∞–Ω–∞–ª–∏–∑ RSA")
        
        # –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞
        with st.expander("üìö –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞", expanded=False):
            st.markdown("""
            **–ö—Ä–∏–ø—Ç–æ–∞–Ω–∞–ª–∏–∑ RSA** - –∏–∑—É—á–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –≤—Å–∫—Ä—ã—Ç–∏—è RSA –∫—Ä–∏–ø—Ç–æ—Å–∏—Å—Ç–µ–º—ã —á–µ—Ä–µ–∑ –∞–Ω–∞–ª–∏–∑ –µ–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–≤–æ–π—Å—Ç–≤.
            
            **–û—Å–Ω–æ–≤–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ RSA:**
            
            **1. –ú–∞–ª–∞—è —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (e)**
            - –ê—Ç–∞–∫–∞ –•–∞—Å—Ç–∞–¥–∞ (–º–∞–ª–æ–µ e, –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)
            - –ê—Ç–∞–∫–∞ –§—Ä–∞–Ω–∫–ª–∏–Ω–∞-–†–µ–π—Ç–µ—Ä–∞ (—Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è)
            - –ê—Ç–∞–∫–∞ –ö–æ–ø–ø–µ—Ä—Å–º–∏—Ç–∞ (–º–∞–ª–æ–µ e, —á–∞—Å—Ç–∏—á–Ω–æ –∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)
            
            **2. –£—è–∑–≤–∏–º–æ—Å—Ç–∏ –º–æ–¥—É–ª—è (n)**
            - –§–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (—Ä–∞–∑–ª–æ–∂–µ–Ω–∏–µ n –Ω–∞ –ø—Ä–æ—Å—Ç—ã–µ –º–Ω–æ–∂–∏—Ç–µ–ª–∏)
            - –û–±—â–∏–µ –º–æ–¥—É–ª–∏
            - –ë–ª–∏–∑–∫–∏–µ –ø—Ä–æ—Å—Ç—ã–µ —á–∏—Å–ª–∞ p –∏ q
            
            **3. –£—è–∑–≤–∏–º–æ—Å—Ç–∏ —Å–µ–∫—Ä–µ—Ç–Ω–æ–π —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç—ã (d)**
            - –ú–∞–ª–∞—è —Å–µ–∫—Ä–µ—Ç–Ω–∞—è —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞ (d < n‚Å∞¬∑¬≤‚Åπ)
            - –ê—Ç–∞–∫–∞ –í–∏–Ω–µ—Ä–∞ (d < n‚Å∞¬∑¬≤‚Åµ)
            - –ê—Ç–∞–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
            
            **4. –ê—Ç–∞–∫–∏ –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é**
            - –ê—Ç–∞–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
            - –ê—Ç–∞–∫–∏ –ø–æ –º–æ—â–Ω–æ—Å—Ç–∏
            - –ê—Ç–∞–∫–∏ –ø–æ –æ—à–∏–±–∫–∞–º
            
            **–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å–Ω–æ–≤—ã:**
            - **RSA:** n = p √ó q, œÜ(n) = (p-1)(q-1)
            - **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ:** c = m·µâ mod n
            - **–î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ:** m = c·µà mod n
            - **–£—Å–ª–æ–≤–∏–µ:** e √ó d ‚â° 1 mod œÜ(n)
            """)
                
        # –í—ã–±–æ—Ä —Ç–∏–ø–∞ –∞—Ç–∞–∫–∏
        attack_type = st.radio(
            "–¢–∏–ø –∫—Ä–∏–ø—Ç–æ–∞–Ω–∞–ª–∏–∑–∞:",
            ["üî¢ –§–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è", "‚ö° –ú–∞–ª–∞—è —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞", "üéØ –ê—Ç–∞–∫–∞ –í–∏–Ω–µ—Ä–∞", 
             "üìä –û–±—â–∏–µ –º–æ–¥—É–ª–∏", "‚è±Ô∏è –ê—Ç–∞–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏", "üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏"],
            horizontal=True
        )
        
        if attack_type == "üî¢ –§–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è":
            self.render_factorization_analysis()
        elif attack_type == "‚ö° –ú–∞–ª–∞—è —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞":
            self.render_small_exponent_analysis()
        elif attack_type == "üéØ –ê—Ç–∞–∫–∞ –í–∏–Ω–µ—Ä–∞":
            self.render_wiener_attack()
        elif attack_type == "üìä –û–±—â–∏–µ –º–æ–¥—É–ª–∏":
            self.render_common_modulus_attack()
        elif attack_type == "‚è±Ô∏è –ê—Ç–∞–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏":
            self.render_timing_attacks()
        else:
            self.render_protection_recommendations()
    
    def render_factorization_analysis(self):
        """–ê–Ω–∞–ª–∏–∑ –º–µ—Ç–æ–¥–æ–≤ —Ñ–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"""
        st.subheader("üî¢ –§–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è RSA –º–æ–¥—É–ª—è")
        
        col1, col2 = st.columns(2)
        
        with col1:
            n = st.number_input(
                "–ú–æ–¥—É–ª—å n –¥–ª—è —Ñ–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:",
                min_value=100,
                max_value=10**12,
                value=323,
                key="factor_n"
            )
            
            method = st.selectbox(
                "–ú–µ—Ç–æ–¥ —Ñ–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:",
                ["–ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–±–æ—Ä", "–ú–µ—Ç–æ–¥ –§–µ—Ä–º–∞", "p-1 –º–µ—Ç–æ–¥ –ü–æ–ª–ª–∞—Ä–¥–∞", "œÅ-–º–µ—Ç–æ–¥ –ü–æ–ª–ª–∞—Ä–¥–∞"],
                key="factor_method"
            )
        
        with col2:
            if st.button("–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ñ–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—é", key="factor_btn"):
                if n > 1:
                    self.perform_factorization(n, method)
                else:
                    st.error("–ú–æ–¥—É–ª—å n –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ 1")
        
        # –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Ñ–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        st.markdown("---")
        st.subheader("üìà –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ñ–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏")
        
        bit_length = st.slider(
            "–î–ª–∏–Ω–∞ –º–æ–¥—É–ª—è n (–±–∏—Ç):",
            min_value=16,
            max_value=128,
            value=32,
            key="bit_length"
        )
        
        if st.button("–û—Ü–µ–Ω–∏—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç—å", key="complexity_btn"):
            self.estimate_factorization_complexity(bit_length)
        
        # –ò–∑–≤–µ—Å—Ç–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        st.markdown("---")
        self.render_known_factorizations()
    
    def render_small_exponent_analysis(self):
        """–ê–Ω–∞–ª–∏–∑ –∞—Ç–∞–∫ –Ω–∞ –º–∞–ª—É—é —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç—É"""
        st.subheader("‚ö° –ê—Ç–∞–∫–∏ –Ω–∞ –º–∞–ª—É—é —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç—É e")
        
        st.markdown("""
        **–¢–∏–ø—ã –∞—Ç–∞–∫ –Ω–∞ –º–∞–ª—É—é e:**
        
        **1. –ê—Ç–∞–∫–∞ –•–∞—Å—Ç–∞–¥–∞:**
        - –û–¥–∏–Ω–∞–∫–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ m, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å —Ä–∞–∑–Ω—ã–º–∏ –º–æ–¥—É–ª—è–º–∏ n·µ¢
        - –¢—Ä–µ–±—É–µ—Ç—Å—è: e —Å–æ–æ–±—â–µ–Ω–∏–π
        - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: m = –∫–æ—Ä–µ–Ω—å e-–π —Å—Ç–µ–ø–µ–Ω–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã —É—Ä–∞–≤–Ω–µ–Ω–∏–π
        
        **2. –ê—Ç–∞–∫–∞ –§—Ä–∞–Ω–∫–ª–∏–Ω–∞-–†–µ–π—Ç–µ—Ä–∞:**
        - –î–≤–∞ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è: m‚ÇÅ –∏ m‚ÇÇ = a¬∑m‚ÇÅ + b
        - –¢—Ä–µ–±—É–µ—Ç—Å—è: –∏–∑–≤–µ—Å—Ç–Ω—ã a, b
        - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ gcd –º–Ω–æ–≥–æ—á–ª–µ–Ω–æ–≤
        
        **3. –ê—Ç–∞–∫–∞ –ö–æ–ø–ø–µ—Ä—Å–º–∏—Ç–∞:**
        - –ß–∞—Å—Ç–∏—á–Ω–æ –∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ LLL-–∞–ª–≥–æ—Ä–∏—Ç–º–∞
        """)
        
        # –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∞—Ç–∞–∫–∏ –•–∞—Å—Ç–∞–¥–∞
        st.markdown("### üéØ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∞—Ç–∞–∫–∏ –•–∞—Å—Ç–∞–¥–∞")
        
        e = st.number_input(
            "–≠–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞ e:",
            min_value=3,
            max_value=100,
            value=3,
            key="hastad_e"
        )
        
        message = st.number_input(
            "–°–æ–æ–±—â–µ–Ω–∏–µ m:",
            min_value=2,
            max_value=1000,
            value=42,
            key="hastad_m"
        )
        
        if st.button("–ü–æ–∫–∞–∑–∞—Ç—å –∞—Ç–∞–∫—É –•–∞—Å—Ç–∞–¥–∞", key="hastad_btn"):
            self.demo_hastad_attack(e, message)
        
        # –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç—ã
        st.markdown("---")
        self.render_exponent_safety_analysis()
    
    def render_wiener_attack(self):
        """–ê—Ç–∞–∫–∞ –í–∏–Ω–µ—Ä–∞ –Ω–∞ –º–∞–ª—É—é —Å–µ–∫—Ä–µ—Ç–Ω—É—é —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç—É"""
        st.subheader("üéØ –ê—Ç–∞–∫–∞ –í–∏–Ω–µ—Ä–∞")
        
        st.markdown("""
        **–ê—Ç–∞–∫–∞ –í–∏–Ω–µ—Ä–∞** –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—É—é —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç—É d, –µ—Å–ª–∏ d < n‚Å∞¬∑¬≤‚Åµ.
        
        **–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**
        - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ü–µ–ø–Ω—ã–µ –¥—Ä–æ–±–∏ –¥–ª—è –∞–ø–ø—Ä–æ–∫—Å–∏–º–∞—Ü–∏–∏ e/n
        - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –Ω–∞ —Ä–æ–ª—å d —á–µ—Ä–µ–∑ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ e¬∑d = k¬∑œÜ(n) + 1
        - –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ–≥–¥–∞ d –º–∞–ª–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ n
        
        **–£—Å–ª–æ–≤–∏—è —É—Å–ø–µ—Ö–∞:**
        - q < p < 2q (–æ–±—ã—á–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ –¥–ª—è RSA)
        - d < ‚Öì¬∑n‚Å∞¬∑¬≤‚Åµ
        """)
        
        col1, col2 = st.columns(2)
        
        with col1:
            n = st.number_input(
                "–ú–æ–¥—É–ª—å n:",
                min_value=1000,
                max_value=10**9,
                value=1000000,
                key="wiener_n"
            )
            
            e = st.number_input(
                "–ü—É–±–ª–∏—á–Ω–∞—è —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞ e:",
                min_value=3,
                max_value=10**6,
                value=65537,
                key="wiener_e"
            )
        
        with col2:
            d_size = st.selectbox(
                "–†–∞–∑–º–µ—Ä —Å–µ–∫—Ä–µ—Ç–Ω–æ–π —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç—ã:",
                ["–ú–∞–ª–∞—è (—É—è–∑–≤–∏–º–∞—è)", "–ë–æ–ª—å—à–∞—è (–±–µ–∑–æ–ø–∞—Å–Ω–∞—è)"],
                key="d_size"
            )
            
            if st.button("–í—ã–ø–æ–ª–Ω–∏—Ç—å –∞—Ç–∞–∫—É –í–∏–Ω–µ—Ä–∞", key="wiener_btn"):
                self.perform_wiener_attack(n, e, d_size)
        
        # –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ü–µ–ø–Ω—ã—Ö –¥—Ä–æ–±–µ–π
        st.markdown("---")
        self.render_continued_fractions_demo()
    
    def render_common_modulus_attack(self):
        """–ê—Ç–∞–∫–∞ –Ω–∞ –æ–±—â–∏–µ –º–æ–¥—É–ª–∏"""
        st.subheader("üìä –ê—Ç–∞–∫–∞ –Ω–∞ –æ–±—â–∏–µ –º–æ–¥—É–ª–∏")
        
        st.markdown("""
        **–ê—Ç–∞–∫–∞ –Ω–∞ –æ–±—â–∏–µ –º–æ–¥—É–ª–∏** –≤–æ–∑–º–æ–∂–Ω–∞ –∫–æ–≥–¥–∞ –¥–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π n 
        –Ω–æ —Ä–∞–∑–Ω—ã–µ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç—ã e‚ÇÅ –∏ e‚ÇÇ.
        
        **–£—Å–ª–æ–≤–∏—è —É—Å–ø–µ—Ö–∞:**
        - gcd(e‚ÇÅ, e‚ÇÇ) = 1
        - –û–¥–∏–Ω–∞–∫–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ m –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ –¥–ª—è –æ–±–æ–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        - c‚ÇÅ = m·µâ¬π mod n, c‚ÇÇ = m·µâ¬≤ mod n
        
        **–ú–µ—Ç–æ–¥:**
        - –ù–∞–π—Ç–∏ a, b —Ç–∞–∫–∏–µ —á—Ç–æ a¬∑e‚ÇÅ + b¬∑e‚ÇÇ = 1 (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ï–≤–∫–ª–∏–¥–∞)
        - –í—ã—á–∏—Å–ª–∏—Ç—å m = c‚ÇÅ·µÉ ¬∑ c‚ÇÇ·µá mod n
        """)
        
        col1, col2 = st.columns(2)
        
        with col1:
            n = st.number_input(
                "–û–±—â–∏–π –º–æ–¥—É–ª—å n:",
                min_value=100,
                max_value=10**6,
                value=323,
                key="common_n"
            )
            
            e1 = st.number_input(
                "–≠–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 1:",
                min_value=3,
                max_value=100,
                value=3,
                key="common_e1"
            )
        
        with col2:
            e2 = st.number_input(
                "–≠–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 2:",
                min_value=3,
                max_value=100,
                value=5,
                key="common_e2"
            )
            
            message = st.number_input(
                "–°–æ–æ–±—â–µ–Ω–∏–µ m:",
                min_value=2,
                max_value=1000,
                value=42,
                key="common_m"
            )
        
        if st.button("–í—ã–ø–æ–ª–Ω–∏—Ç—å –∞—Ç–∞–∫—É", key="common_btn"):
            self.perform_common_modulus_attack(n, e1, e2, message)
    
    def render_timing_attacks(self):
        """–ê—Ç–∞–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ RSA"""
        st.subheader("‚è±Ô∏è –ê—Ç–∞–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ RSA")
        
        st.markdown("""
        **–ê—Ç–∞–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏** –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞–∑–ª–∏—á–∏—è –≤–æ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π 
        –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.
        
        **–£—è–∑–≤–∏–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ RSA:**
        - –ú–æ–¥—É–ª—å–Ω–æ–µ –≤–æ–∑–≤–µ–¥–µ–Ω–∏–µ –≤ —Å—Ç–µ–ø–µ–Ω—å (–∫–≤–∞–¥—Ä–∞—Ç—ã –∏ —É–º–Ω–æ–∂–µ–Ω–∏—è)
        - –ö–∏—Ç–∞–π—Å–∫–∞—è —Ç–µ–æ—Ä–µ–º–∞ –æ–± –æ—Å—Ç–∞—Ç–∫–∞—Ö (CRT)
        - –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ë–ª—é–º–∞-–ì–æ–ª—å–¥–≤–∞—Å—Å–µ—Ä–∞
        
        **–ú–µ—Ç–æ–¥—ã –∑–∞—â–∏—Ç—ã:**
        - –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        - –°–ª–µ–ø—ã–µ –ø–æ–¥–ø–∏—Å–∏
        - –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç—ã
        """)
        
        # –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è timing attack
        st.markdown("### ‚ö° –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è timing attack")
        
        implementation_type = st.radio(
            "–¢–∏–ø —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:",
            ["–ù–∞–∏–≤–Ω–∞—è (—É—è–∑–≤–∏–º–∞—è)", "–ó–∞—â–∏—â–µ–Ω–Ω–∞—è (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –≤—Ä–µ–º—è)"],
            key="rsa_timing_impl"
        )
        
        if st.button("–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è", key="rsa_timing_btn"):
            self.demo_rsa_timing_attack(implementation_type)
        
        # –ó–∞—â–∏—Ç–∞ –æ—Ç timing attacks
        st.markdown("---")
        self.render_rsa_timing_protection()
    
    def render_protection_recommendations(self):
        """–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∑–∞—â–∏—Ç–µ"""
        st.subheader("üõ°Ô∏è –ó–∞—â–∏—Ç–∞ RSA –æ—Ç –∫—Ä–∏–ø—Ç–æ–∞–Ω–∞–ª–∏–∑–∞")
        
        col1, col2 = st.columns(2)
        
        with col1:
            st.markdown("""
            **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º:**
            
            ‚úÖ **–†–∞–∑–º–µ—Ä –º–æ–¥—É–ª—è:**
            - 2048 –±–∏—Ç (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ –¥–æ 2030)
            - 3072 –±–∏—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
            - 4096 –±–∏—Ç (–¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
            
            ‚úÖ **–í—ã–±–æ—Ä –ø—Ä–æ—Å—Ç—ã—Ö —á–∏—Å–µ–ª:**
            - –°–ª—É—á–∞–π–Ω—ã–µ –ø—Ä–æ—Å—Ç—ã–µ —á–∏—Å–ª–∞
            - –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–ª—å—à–∏–µ p –∏ q
            - |p-q| > 2¬π‚Å∞‚Å∞ –¥–ª—è 2048-–±–∏—Ç–Ω–æ–≥–æ n
            
            ‚úÖ **–ü—É–±–ª–∏—á–Ω–∞—è —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞:**
            - e = 65537 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
            - –ò–∑–±–µ–≥–∞—Ç—å –º–∞–ª—ã—Ö e (3, 17)
            - –ü—Ä–æ–≤–µ—Ä—è—Ç—å gcd(e, œÜ(n)) = 1
            """)
        
        with col2:
            st.markdown("""
            **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
            
            ‚úÖ **–°–µ–∫—Ä–µ—Ç–Ω–∞—è —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞:**
            - d > n‚Å∞¬∑¬≤‚Åµ (–ø—Ä–æ—Ç–∏–≤ –∞—Ç–∞–∫–∏ –í–∏–Ω–µ—Ä–∞)
            - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CRT –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
            
            ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫:**
            - –°–ª–µ–ø—ã–µ –ø–æ–¥–ø–∏—Å–∏
            - –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
            - –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫
            
            ‚úÖ **–ü—Ä–æ—Ç–æ–∫–æ–ª—ã:**
            - OAEP padding –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
            - PSS –¥–ª—è –ø–æ–¥–ø–∏—Å–µ–π
            - –†–µ–≥—É–ª—è—Ä–Ω–∞—è —Å–º–µ–Ω–∞ –∫–ª—é—á–µ–π
            """)
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        st.markdown("---")
        st.markdown("### üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ RSA –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤")
        
        if st.button("–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏", key="rsa_security_check_btn"):
            self.run_rsa_security_checks()
    
    def perform_factorization(self, n: int, method: str):
        """–í—ã–ø–æ–ª–Ω—è–µ—Ç —Ñ–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–∏—Å–ª–∞ n"""
        st.markdown(f"### üîç –§–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è {n} –º–µ—Ç–æ–¥–æ–º {method}")
        
        start_time = time.time()
        
        if method == "–ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–±–æ—Ä":
            factors = self.trial_division(n)
        elif method == "–ú–µ—Ç–æ–¥ –§–µ—Ä–º–∞":
            factors = self.fermat_method(n)
        elif method == "p-1 –º–µ—Ç–æ–¥ –ü–æ–ª–ª–∞—Ä–¥–∞":
            factors = self.pollard_p1(n)
        else:  # œÅ-–º–µ—Ç–æ–¥ –ü–æ–ª–ª–∞—Ä–¥–∞
            factors = self.pollard_rho(n)
        
        end_time = time.time()
        
        if factors:
            st.success(f"‚úÖ –ù–∞–π–¥–µ–Ω—ã –º–Ω–æ–∂–∏—Ç–µ–ª–∏: {factors}")
            st.info(f"–ü—Ä–æ–≤–µ—Ä–∫–∞: {factors[0]} √ó {factors[1]} = {factors[0] * factors[1]}")
        else:
            st.error("‚ùå –§–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å")
        
        st.info(f"‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: {end_time - start_time:.4f} —Å–µ–∫—É–Ω–¥")
        
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        if factors and len(factors) == 2:
            p, q = factors
            phi = (p - 1) * (q - 1)
            st.markdown(f"**œÜ(n) = (p-1)(q-1) = {phi}**")
    
    def trial_division(self, n: int) -> List[int]:
        """–ú–µ—Ç–æ–¥ –ø—Ä–æ–±–Ω–æ–≥–æ –¥–µ–ª–µ–Ω–∏—è"""
        factors = []
        temp_n = n
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞–ª–µ–Ω—å–∫–∏–µ –ø—Ä–æ—Å—Ç—ã–µ —á–∏—Å–ª–∞
        for p in [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31]:
            while temp_n % p == 0:
                factors.append(p)
                temp_n //= p
            if temp_n == 1:
                break
        
        # –ï—Å–ª–∏ —á–∏—Å–ª–æ —É–∂–µ —Ä–∞–∑–ª–æ–∂–µ–Ω–æ
        if temp_n == 1:
            return factors
        
        # –ü—Ä–æ–±–Ω–æ–µ –¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –æ—Å—Ç–∞—Ç–∫–∞
        f = 37
        while f * f <= temp_n:
            if temp_n % f == 0:
                factors.append(f)
                temp_n //= f
            else:
                f += 2
        
        if temp_n > 1:
            factors.append(temp_n)
        
        # –î–ª—è RSA –Ω–∞–º –Ω—É–∂–Ω—ã 2 –º–Ω–æ–∂–∏—Ç–µ–ª—è
        if len(factors) >= 2:
            # –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ –º–Ω–æ–∂–∏—Ç–µ–ª–∏ –∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤ –æ–¥–∏–Ω
            p = 1
            for factor in factors[:-1]:
                p *= factor
            return [p, factors[-1]]
        
        return []
    
    def fermat_method(self, n: int) -> List[int]:
        """–ú–µ—Ç–æ–¥ —Ñ–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –§–µ—Ä–º–∞"""
        if n % 2 == 0:
            return [2, n // 2]
        
        x = math.isqrt(n)
        if x * x == n:
            return [x, x]
        
        x += 1
        max_iterations = 10000
        
        for _ in range(max_iterations):
            y2 = x * x - n
            y = math.isqrt(y2)
            
            if y * y == y2:
                p = x - y
                q = x + y
                if p * q == n:
                    return [p, q]
            
            x += 1
        
        return []
    
    def pollard_p1(self, n: int) -> List[int]:
        """p-1 –º–µ—Ç–æ–¥ –ü–æ–ª–ª–∞—Ä–¥–∞"""
        if n % 2 == 0:
            return [2, n // 2]
        
        a = 2
        max_iterations = 1000
        
        for i in range(2, max_iterations):
            a = pow(a, i, n)
            d = math.gcd(a - 1, n)
            
            if 1 < d < n:
                return [d, n // d]
        
        return []
    
    def pollard_rho(self, n: int) -> List[int]:
        """œÅ-–º–µ—Ç–æ–¥ –ü–æ–ª–ª–∞—Ä–¥–∞"""
        if n % 2 == 0:
            return [2, n // 2]
        
        def f(x):
            return (x * x + 1) % n
        
        x, y, d = 2, 2, 1
        max_iterations = 10000
        
        for _ in range(max_iterations):
            x = f(x)
            y = f(f(y))
            d = math.gcd(abs(x - y), n)
            
            if d != 1 and d != n:
                return [d, n // d]
        
        return []
    
    def estimate_factorization_complexity(self, bit_length: int):
        """–û—Ü–µ–Ω–∏–≤–∞–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ñ–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"""
        st.markdown(f"### üìä –û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è {bit_length}-–±–∏—Ç–Ω–æ–≥–æ –º–æ–¥—É–ª—è")
        
        n_size = 2**bit_length
        complexities = {
            '–ú–µ—Ç–æ–¥': ['–ö–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–µ —Ä–µ—à–µ—Ç–æ', '–ú–µ—Ç–æ–¥ —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–∏—Ö –∫—Ä–∏–≤—ã—Ö', '–û–±—â–∏–π –º–µ—Ç–æ–¥ —Ä–µ—à–µ—Ç–∞ —á–∏—Å–ª–æ–≤–æ–≥–æ –ø–æ–ª—è'],
            '–°–ª–æ–∂–Ω–æ—Å—Ç—å': [
                f'O(exp(‚àö(ln {n_size} ln ln {n_size})))',
                f'O(exp(‚àö(2 ln {n_size} ln ln {n_size})))', 
                f'O(exp((64/9)^(1/3) (ln {n_size})^(1/3) (ln ln {n_size})^(2/3)))'
            ],
            '–ü—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å': [
                '–î–æ ~100 –±–∏—Ç',
                '–î–æ ~130 –±–∏—Ç', 
                '> 512 –±–∏—Ç'
            ]
        }
        
        df = pd.DataFrame(complexities)
        st.dataframe(df, use_container_width=True, hide_index=True)
        
        # –ò–∑–≤–µ—Å—Ç–Ω—ã–µ —Ä–µ–∫–æ—Ä–¥—ã —Ñ–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        records_data = {
            '–ì–æ–¥': ['1991', '1999', '2009', '2019'],
            '–î–ª–∏–Ω–∞ (–±–∏—Ç)': ['116', '155', '232', '240'],
            '–ú–µ—Ç–æ–¥': ['–ö–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–µ —Ä–µ—à–µ—Ç–æ', '–û–±—â–∏–π –º–µ—Ç–æ–¥ —Ä–µ—à–µ—Ç–∞', '–û–±—â–∏–π –º–µ—Ç–æ–¥ —Ä–µ—à–µ—Ç–∞', '–û–±—â–∏–π –º–µ—Ç–æ–¥ —Ä–µ—à–µ—Ç–∞'],
            '–í—Ä–µ–º—è': ['1 –º–µ—Å—è—Ü', '7 –º–µ—Å—è—Ü–µ–≤', '2 –≥–æ–¥–∞', '1 –≥–æ–¥']
        }
        
        st.markdown("### üèÜ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ —Ä–µ–∫–æ—Ä–¥—ã —Ñ–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏")
        df_records = pd.DataFrame(records_data)
        st.dataframe(df_records, use_container_width=True, hide_index=True)
    
    def render_known_factorizations(self):
        """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"""
        st.markdown("### üìö –ò–∑–≤–µ—Å—Ç–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ RSA —á–∏—Å–µ–ª")
        
        rsa_numbers = {
            'RSA-100': 1522605027922533360535618378132637429718068114961380688657908494580122963258952897654000350692006139,
            'RSA-110': 35794234179725868774991807832568455403003778024228226193532908190484670252364677411513516111204504060317568667,
            'RSA-120': 227010481295437363334259960947493668895875336466084780038173258247009162675779735389791151574049166747880487470296548479
        }
        
        for name, value in rsa_numbers.items():
            with st.expander(f"{name}"):
                st.text(f"n = {value}")
                st.info(f"–î–ª–∏–Ω–∞: {len(str(value))} —Ü–∏—Ñ—Ä")
    
    def demo_hastad_attack(self, e: int, m: int):
        """–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∞—Ç–∞–∫–∏ –•–∞—Å—Ç–∞–¥–∞"""
        st.markdown("### üîì –ê—Ç–∞–∫–∞ –•–∞—Å—Ç–∞–¥–∞ –Ω–∞ –º–∞–ª—É—é —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç—É")
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–æ–¥—É–ª–µ–π
        modules = []
        ciphers = []
        
        for i in range(e):
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ—Å—Ç—ã–µ —á–∏—Å–ª–∞
            p = sympy.randprime(100, 1000)
            q = sympy.randprime(100, 1000)
            n = p * q
            modules.append(n)
            
            # –®–∏—Ñ—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            c = pow(m, e, n)
            ciphers.append(c)
        
        st.success(f"–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ {e} –ø–∞—Ä –∫–ª—é—á–µ–π —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º m = {m}")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        data = []
        for i in range(e):
            data.append({
                '–ú–æ–¥—É–ª—å n·µ¢': modules[i],
                '–®–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç c·µ¢': ciphers[i]
            })
        
        df = pd.DataFrame(data)
        st.dataframe(df, use_container_width=True)
        
        # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (–¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)
        st.info("""
        **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
        - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ö–∏—Ç–∞–π—Å–∫–∞—è —Ç–µ–æ—Ä–µ–º–∞ –æ–± –æ—Å—Ç–∞—Ç–∫–∞—Ö
        - –ù–∞—Ö–æ–¥–∏—Ç—Å—è M = m·µâ mod (n‚ÇÅ¬∑n‚ÇÇ¬∑...¬∑n‚Çë)
        - –¢–∞–∫ –∫–∞–∫ m·µâ < n‚ÇÅ¬∑n‚ÇÇ¬∑...¬∑n‚Çë, —Ç–æ M = m·µâ
        - –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∫–æ—Ä–µ–Ω—å e-–π —Å—Ç–µ–ø–µ–Ω–∏: m = ·µâ‚àöM
        """)
        
        # –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∂–µ–º –º–∞—Ç–µ–º–∞—Ç–∏–∫—É
        st.success(f"‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: m = {m}")
    
    def render_exponent_safety_analysis(self):
        """–ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç—ã"""
        st.markdown("### üìà –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç—ã e")
        
        e_values = [3, 17, 65537]
        analysis_data = []
        
        for e in e_values:
            security_level = "–ù–∏–∑–∫–∏–π" if e == 3 else "–°—Ä–µ–¥–Ω–∏–π" if e == 17 else "–í—ã—Å–æ–∫–∏–π"
            vulnerabilities = "–ê—Ç–∞–∫–∞ –•–∞—Å—Ç–∞–¥–∞, –§—Ä–∞–Ω–∫–ª–∏–Ω–∞-–†–µ–π—Ç–µ—Ä–∞" if e == 3 else "–í–æ–∑–º–æ–∂–Ω—ã –∞—Ç–∞–∫–∏" if e == 17 else "–ë–µ–∑–æ–ø–∞—Å–Ω–æ"
            
            analysis_data.append({
                '–≠–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞ e': e,
                '–£—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏': security_level,
                '–£—è–∑–≤–∏–º–æ—Å—Ç–∏': vulnerabilities,
                '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è': '–ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å' if e == 3 else '–û—Å—Ç–æ—Ä–æ–∂–Ω–æ' if e == 17 else '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è'
            })
        
        df = pd.DataFrame(analysis_data)
        st.dataframe(df, use_container_width=True, hide_index=True)
    
    def perform_wiener_attack(self, n: int, e: int, d_size: str):
        """–í—ã–ø–æ–ª–Ω—è–µ—Ç –∞—Ç–∞–∫—É –í–∏–Ω–µ—Ä–∞"""
        st.markdown("### üéØ –ê—Ç–∞–∫–∞ –í–∏–Ω–µ—Ä–∞ –Ω–∞ –º–∞–ª—É—é —Å–µ–∫—Ä–µ—Ç–Ω—É—é —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç—É")
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É—è–∑–≤–∏–º—ã–µ –∏–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        if d_size == "–ú–∞–ª–∞—è (—É—è–∑–≤–∏–º–∞—è)":
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –º–∞–ª—É—é d
            p = sympy.randprime(2**8, 2**10)
            q = sympy.randprime(2**8, 2**10)
            n = p * q
            phi = (p - 1) * (q - 1)
            
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –º–∞–ª—É—é d
            d = sympy.randprime(2, n**0.25)
            e = mod_inverse(d, phi)
            
            st.warning("‚ö†Ô∏è –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã —É—è–∑–≤–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å –º–∞–ª–æ–π d")
        else:
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            p = sympy.randprime(2**8, 2**10)
            q = sympy.randprime(2**8, 2**10)
            n = p * q
            phi = (p - 1) * (q - 1)
            e = 65537
            d = mod_inverse(e, phi)
            
            st.success("‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã")
        
        st.markdown(f"""
        **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã RSA:**
        - n = {n}
        - e = {e}
        - d = {d}
        - –†–∞–∑–º–µ—Ä d: {d.bit_length()} –±–∏—Ç
        - –ü—Ä–µ–¥–µ–ª –í–∏–Ω–µ—Ä–∞: ~{int(n**0.25)} –±–∏—Ç
        """)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—è–∑–≤–∏–º–æ—Å—Ç—å
        if d < n**0.25:
            st.error("üö® –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —É—è–∑–≤–∏–º—ã –∫ –∞—Ç–∞–∫–µ –í–∏–Ω–µ—Ä–∞!")
            st.info("–ê—Ç–∞–∫–∞ –í–∏–Ω–µ—Ä–∞ –º–æ–∂–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å d —á–µ—Ä–µ–∑ —Ü–µ–ø–Ω—ã–µ –¥—Ä–æ–±–∏ e/n")
        else:
            st.success("‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω—ã –ø—Ä–æ—Ç–∏–≤ –∞—Ç–∞–∫–∏ –í–∏–Ω–µ—Ä–∞")
    
    def render_continued_fractions_demo(self):
        """–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ü–µ–ø–Ω—ã—Ö –¥—Ä–æ–±–µ–π"""
        st.markdown("### üî¢ –¶–µ–ø–Ω—ã–µ –¥—Ä–æ–±–∏ –≤ –∞—Ç–∞–∫–µ –í–∏–Ω–µ—Ä–∞")
        
        number = st.number_input(
            "–ß–∏—Å–ª–æ –¥–ª—è —Ä–∞–∑–ª–æ–∂–µ–Ω–∏—è –≤ —Ü–µ–ø–Ω—É—é –¥—Ä–æ–±—å:",
            value=3.245,
            key="continued_fraction"
        )
        
        if st.button("–†–∞–∑–ª–æ–∂–∏—Ç—å –≤ —Ü–µ–ø–Ω—É—é –¥—Ä–æ–±—å", key="continued_btn"):
            self.demo_continued_fractions(number)
    
    def demo_continued_fractions(self, x: float):
        """–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–∑–ª–æ–∂–µ–Ω–∏—è –≤ —Ü–µ–ø–Ω—É—é –¥—Ä–æ–±—å"""
        result = []
        a = []
        
        temp_x = x
        for _ in range(10):  # –û–≥—Ä–∞–Ω–∏—á–∏–º –¥–ª–∏–Ω—É
            integer_part = int(temp_x)
            a.append(integer_part)
            fractional_part = temp_x - integer_part
            
            if abs(fractional_part) < 1e-10:
                break
                
            temp_x = 1 / fractional_part
        
        # –°—Ç—Ä–æ–∏–º –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –¥—Ä–æ–±–∏
        convergents = []
        if len(a) >= 1:
            h0, k0 = a[0], 1
            convergents.append((h0, k0))
            
        if len(a) >= 2:
            h1, k1 = a[0]*a[1] + 1, a[1]
            convergents.append((h1, k1))
            
        for i in range(2, len(a)):
            h = a[i] * convergents[i-1][0] + convergents[i-2][0]
            k = a[i] * convergents[i-1][1] + convergents[i-2][1]
            convergents.append((h, k))
        
        st.success(f"–†–∞–∑–ª–æ–∂–µ–Ω–∏–µ {x} –≤ —Ü–µ–ø–Ω—É—é –¥—Ä–æ–±—å:")
        st.code("[" + ", ".join(map(str, a)) + "]")
        
        st.markdown("**–ü–æ–¥—Ö–æ–¥—è—â–∏–µ –¥—Ä–æ–±–∏:**")
        data = []
        for i, (h, k) in enumerate(convergents):
            data.append({
                '–®–∞–≥': i + 1,
                '–î—Ä–æ–±—å': f"{h}/{k}",
                '–ó–Ω–∞—á–µ–Ω–∏–µ': h/k,
                '–ü–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å': abs(x - h/k)
            })
        
        df = pd.DataFrame(data)
        st.dataframe(df, use_container_width=True, hide_index=True)
    
    def perform_common_modulus_attack(self, n: int, e1: int, e2: int, m: int):
        """–í—ã–ø–æ–ª–Ω—è–µ—Ç –∞—Ç–∞–∫—É –Ω–∞ –æ–±—â–∏–µ –º–æ–¥—É–ª–∏"""
        st.markdown("### üìä –ê—Ç–∞–∫–∞ –Ω–∞ –æ–±—â–∏–µ –º–æ–¥—É–ª–∏")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è
        if math.gcd(e1, e2) != 1:
            st.error("‚ùå –ê—Ç–∞–∫–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞: gcd(e‚ÇÅ, e‚ÇÇ) ‚â† 1")
            return
        
        # –®–∏—Ñ—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        c1 = pow(m, e1, n)
        c2 = pow(m, e2, n)
        
        st.success(f"–°–æ–æ–±—â–µ–Ω–∏–µ m = {m} –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ:")
        st.markdown(f"- c‚ÇÅ = m·µâ¬π mod n = {c1}")
        st.markdown(f"- c‚ÇÇ = m·µâ¬≤ mod n = {c2}")
        
        # –ù–∞—Ö–æ–¥–∏–º a –∏ b —Ç–∞–∫–∏–µ —á—Ç–æ a¬∑e‚ÇÅ + b¬∑e‚ÇÇ = 1
        gcd_val, a, b = self.extended_gcd(e1, e2)
        
        st.info(f"–ù–∞–π–¥–µ–Ω—ã –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã: {a}¬∑{e1} + {b}¬∑{e2} = {gcd_val}")
        
        # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        if a < 0:
            c1_inv = pow(c1, -1, n)
            recovered_m = (pow(c1_inv, -a, n) * pow(c2, b, n)) % n
        elif b < 0:
            c2_inv = pow(c2, -1, n)
            recovered_m = (pow(c1, a, n) * pow(c2_inv, -b, n)) % n
        else:
            recovered_m = (pow(c1, a, n) * pow(c2, b, n)) % n
        
        if recovered_m == m:
            st.success(f"‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: m = {recovered_m}")
        else:
            st.error(f"‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: –ø–æ–ª—É—á–µ–Ω–æ {recovered_m}")
    
    def extended_gcd(self, a: int, b: int) -> Tuple[int, int, int]:
        """–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ï–≤–∫–ª–∏–¥–∞"""
        if a == 0:
            return b, 0, 1
        
        gcd_val, x1, y1 = self.extended_gcd(b % a, a)
        x = y1 - (b // a) * x1
        y = x1
        
        return gcd_val, x, y
    
    def demo_rsa_timing_attack(self, implementation_type: str):
        """–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è timing attack –Ω–∞ RSA"""
        st.markdown("### ‚è±Ô∏è –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ RSA –æ–ø–µ—Ä–∞—Ü–∏–π")
        
        # –ò–º–∏—Ç–∏—Ä—É–µ–º timing attack
        times_square = []
        times_multiply = []
        
        for i in range(50):
            if implementation_type == "–ù–∞–∏–≤–Ω–∞—è (—É—è–∑–≤–∏–º–∞—è)":
                # –£—è–∑–≤–∏–º–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è - —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ –∏ —É–º–Ω–æ–∂–µ–Ω–∏–π
                time_square = 0.1 + random.uniform(0.01, 0.03)
                time_multiply = 0.1 + random.uniform(0.02, 0.05)
            else:
                # –ó–∞—â–∏—â–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è - –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –≤—Ä–µ–º—è
                base_time = 0.1
                time_square = base_time + random.uniform(0.005, 0.015)
                time_multiply = base_time + random.uniform(0.005, 0.015)
            
            times_square.append(time_square)
            times_multiply.append(time_multiply)
        
        # –°—Ç—Ä–æ–∏–º –≥—Ä–∞—Ñ–∏–∫
        fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(12, 4))
        
        ax1.plot(times_square, 'o-', alpha=0.7, label='–ö–≤–∞–¥—Ä–∞—Ç—ã')
        ax1.set_title('–í—Ä–µ–º—è –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–æ–∑–≤–µ–¥–µ–Ω–∏—è –≤ –∫–≤–∞–¥—Ä–∞—Ç')
        ax1.set_xlabel('–ù–æ–º–µ—Ä –æ–ø–µ—Ä–∞—Ü–∏–∏')
        ax1.set_ylabel('–í—Ä–µ–º—è (—Å–µ–∫)')
        ax1.grid(True, alpha=0.3)
        ax1.legend()
        
        ax2.plot(times_multiply, 'o-', alpha=0.7, color='red', label='–£–º–Ω–æ–∂–µ–Ω–∏—è')
        ax2.set_title('–í—Ä–µ–º—è –æ–ø–µ—Ä–∞—Ü–∏–∏ —É–º–Ω–æ–∂–µ–Ω–∏—è')
        ax2.set_xlabel('–ù–æ–º–µ—Ä –æ–ø–µ—Ä–∞—Ü–∏–∏')
        ax2.set_ylabel('–í—Ä–µ–º—è (—Å–µ–∫)')
        ax2.grid(True, alpha=0.3)
        ax2.legend()
        
        st.pyplot(fig)
        
        # –ê–Ω–∞–ª–∏–∑
        std_square = np.std(times_square)
        std_multiply = np.std(times_multiply)
        mean_diff = abs(np.mean(times_square) - np.mean(times_multiply))
        
        if implementation_type == "–ù–∞–∏–≤–Ω–∞—è (—É—è–∑–≤–∏–º–∞—è)":
            if mean_diff > 0.01:
                st.error("üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —É—è–∑–≤–∏–º–æ—Å—Ç—å! –í—Ä–µ–º—è –æ–ø–µ—Ä–∞—Ü–∏–π —Ä–∞–∑–ª–∏—á–∞–µ—Ç—Å—è")
                st.warning("–ê—Ç–∞–∫—É—é—â–∏–π –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –±–∏—Ç—ã —Å–µ–∫—Ä–µ—Ç–Ω–æ–π —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç—ã d")
            else:
                st.success("‚úÖ –í—Ä–µ–º—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–æ")
        else:
            if mean_diff < 0.005 and std_square < 0.01 and std_multiply < 0.01:
                st.success("‚úÖ –ó–∞—â–∏—â–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è - –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è")
            else:
                st.warning("‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Ä–∞–∑–ª–∏—á–∏—è –≤–æ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è")
    
    def render_rsa_timing_protection(self):
        """–ú–µ—Ç–æ–¥—ã –∑–∞—â–∏—Ç—ã –æ—Ç timing attacks –≤ RSA"""
        st.markdown("### üõ°Ô∏è –ó–∞—â–∏—Ç–∞ RSA –æ—Ç timing attacks")
        
        protection_data = {
            '–ú–µ—Ç–æ–¥': [
                '–°–ª–µ–ø—ã–µ –ø–æ–¥–ø–∏—Å–∏',
                '–ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è',
                '–ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç—ã',
                '–ê–ø–ø–∞—Ä–∞—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è'
            ],
            '–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã': [
                '–°–æ–æ–±—â–µ–Ω–∏–µ –º–∞—Å–∫–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –ø–æ–¥–ø–∏—Å—å—é',
                '–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∑–∞ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –≤—Ä–µ–º—è',
                '–°–µ–∫—Ä–µ—Ç–Ω–∞—è —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞ –º–∞—Å–∫–∏—Ä—É–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏',
                '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–∞—â–∏—â–µ–Ω–Ω–æ–≥–æ hardware'
            ],
            '–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å': [
                '–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è',
                '–í—ã—Å–æ–∫–∞—è',
                '–í—ã—Å–æ–∫–∞—è',
                '–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è'
            ]
        }
        
        df = pd.DataFrame(protection_data)
        st.dataframe(df, use_container_width=True, hide_index=True)
    
    def run_rsa_security_checks(self):
        """–ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ RSA"""
        st.markdown("### üîí –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ RSA")
        
        checks = [
            ("–†–∞–∑–º–µ—Ä –º–æ–¥—É–ª—è ‚â• 2048 –±–∏—Ç", True),
            ("–≠–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞ e = 65537", True),
            ("–°–µ–∫—Ä–µ—Ç–Ω–∞—è —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞ d > n‚Å∞¬∑¬≤‚Åµ", True),
            ("–ü—Ä–æ—Å—Ç—ã–µ —á–∏—Å–ª–∞ p –∏ q —Å–ª—É—á–∞–π–Ω—ã", True),
            ("|p - q| > 2¬π‚Å∞‚Å∞", True),
            ("–ó–∞—â–∏—Ç–∞ –æ—Ç timing attacks", False),
            ("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ OAEP/PSS", True),
            ("–†–µ–≥—É–ª—è—Ä–Ω–∞—è —Å–º–µ–Ω–∞ –∫–ª—é—á–µ–π", False)
        ]
        
        passed = 0
        total = len(checks)
        
        for check_name, status in checks:
            col1, col2 = st.columns([3, 1])
            with col1:
                st.write(check_name)
            with col2:
                if status:
                    st.success("‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ")
                    passed += 1
                else:
                    st.error("‚ùå –ù–µ –ø—Ä–æ–π–¥–µ–Ω–æ")
        
        # –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞
        score = (passed / total) * 100
        st.markdown(f"**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: {score:.1f}%**")
        
        if score >= 80:
            st.success("üéâ –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏")
        elif score >= 60:
            st.warning("‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏")
        else:
            st.error("üö® –ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ - —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞")

# –î–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
class RSACryptanalysis(RSACryptanalysisModule):
    pass
